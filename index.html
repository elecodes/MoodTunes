<!doctype html>
<html lang="en">

<head>
  <style>
    /* Force Voiceflow Widget to Top Right */
    #voiceflow-chat {
      bottom: auto !important;
      top: 90px !important;
      /* Below the 60px header + padding */
      right: 20px !important;
      left: auto !important;
    }
  </style>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' https://cdn.voiceflow.com https://*.voiceflow.com 'unsafe-inline'; connect-src 'self' https://itunes.apple.com https://*.voiceflow.com; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https://cdn.voiceflow.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https://*.voiceflow.com; media-src 'self' https://*.mzstatic.com;">
  <title>MoodTunes</title>

  <!-- ðŸ”¹ Contenedor React -->
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
  <script type="text/javascript">
    (function (d, t) {
      console.log("Voiceflow: Initializing widget script...");
      var v = d.createElement(t), s = d.getElementsByTagName(t)[0];

      v.onload = function () {
        console.log("Voiceflow: Script loaded. Initializing chat...");
        window.voiceflow.chat.load({
          verify: { projectID: '696d1ce1879820474bf9d87a' },
          url: 'https://general-runtime.voiceflow.com',
          versionID: 'production',
          voice: {
            url: "https://runtime-api.voiceflow.com"
          },
          render: {
            mode: 'overlay'
          },
          assistant: {
            extensions: [
              {
                name: 'MusicHandler',
                type: 'response',
                match: (trace) => trace.payload && trace.payload.search_terms,
                render: ({ trace, element }) => {
                  console.log("Voiceflow: Music extension triggered", trace);
                  if (window.handleVoiceflowMusic) {
                    window.handleVoiceflowMusic(trace.payload.search_terms);
                  }
                  element.innerHTML = '<div style="font-size: 0.8em; color: #666; margin-top: 5px;">ðŸŽµ Searching music...</div>';
                }
              }
            ]
          }
        }).then(() => console.log("Voiceflow: Chat loaded successfully"))
          .catch((err) => console.error("Voiceflow: Chat load failed", err));
      }

      v.onerror = function (e) {
        console.error("Voiceflow: Script failed to load", e);
      };

      v.src = "https://cdn.voiceflow.com/widget-next/bundle.mjs"; v.type = "text/javascript"; s.parentNode.insertBefore(v, s);
    })(document, 'script');
  </script>
  </body>

</html>